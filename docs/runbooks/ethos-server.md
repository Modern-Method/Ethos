# Runbook: Ethos Server (IPC)

**Owner:** Forge  
**Last Updated:** 2026-02-22  
**Status:** Active

---

## ğŸ—ï¸ Architecture & Flow

```mermaid
graph TD;
    A[Client (TypeScript Hook)] -->|MessagePack / Unix Socket| B(Ethos Server);
    B -->|Router| C{Handler};
    C -->|SQL| D[(PostgreSQL)];
    D -->|Result| C;
    C -->|Response| A;
```

## ğŸš€ How to Run locally

```bash
# Standard dev run (requires DB running)
cargo run --bin ethos-server

# Health check mode
cargo run --bin ethos-server -- --health
```

## ğŸ§ª How to Test

```bash
# Unit tests
cargo test --package ethos-server

# Integration test (requires DB)
cargo test --test ipc_flow
```

## ğŸ” Observability & Debugging

**Key Logs:**
- `INFO ethos_server::server`: IPC Server listening on `/tmp/ethos.sock`
- `ERROR ethos_server::server`: Frame error or deserialization failure

**Common Issues:**
1. **Issue:** `Address already in use` (socket file exists)
   - **Symptom:** Server fails to start with panic on bind.
   - **Fix:** `rm /tmp/ethos.sock` (server cleans up on exit, but crash leaves it).

## ğŸš¨ Emergency Procedures

**If server hangs:**
1. Stop the service: `pkill ethos-server`
2. Remove socket: `rm /tmp/ethos.sock`
3. Check DB connection: `psql -d ethos`

---

*Generated by Neko for Story 002.*
